# YOLO 车辆和行人检测与跟踪系统

这个项目使用 YOLOv8 检测视频中的车辆和行人，并实现目标跟踪功能。

## 功能特性

- **多目标检测**: 支持检测人、汽车、卡车、公交车、摩托车、自行车
- **目标跟踪**: 实现稳定的目标跟踪，为每个检测到的对象分配唯一ID
- **轨迹可视化**: 显示每个跟踪对象的历史轨迹
- **实时性能**: 优化的算法，支持实时处理
- **多种输入源**: 支持摄像头、视频文件、RTSP流
- **统计信息**: 实时显示人数、车辆数量和FPS

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 基本使用

```bash
python detection_car.py
```

### 选择视频源

程序启动时会提示选择视频源：
1. **Webcam** (默认) - 使用默认摄像头
2. **Video file** - 输入视频文件路径
3. **RTSP stream** - 输入RTSP流地址

### 保存输出

可以选择是否保存处理后的视频到文件。

### 快捷键

- **q**: 退出程序
- **s**: 保存当前帧为图片

## 类和功能说明

### ObjectTracker 类

- 实现自定义的目标跟踪算法
- 使用质心距离进行对象匹配
- 处理对象出现和消失的情况
- 维护每个对象的轨迹历史

### YOLODetector 类

- 封装YOLOv8检测功能
- 只检测指定的目标类别（人、车辆等）
- 为不同类别分配不同颜色
- 绘制检测框、标签和轨迹

### VideoProcessor 类

- 处理视频流输入
- 协调检测和跟踪功能
- 显示统计信息
- 处理用户输入

## 检测类别和颜色

| 类别 | 颜色 | 说明 |
|------|------|------|
| person | 绿色 (0,255,0) | 行人 |
| car | 红色 (0,0,255) | 汽车 |
| truck | 蓝色 (255,0,0) | 卡车 |
| bus | 青色 (255,255,0) | 公交车 |
| motorcycle | 紫色 (255,0,255) | 摩托车 |
| bicycle | 黄色 (0,255,255) | 自行车 |

## 性能参数

- **跟踪参数**:
  - `max_disappeared`: 对象消失最大帧数 (默认: 10)
  - `max_distance`: 匹配最大距离 (默认: 50像素)

- **检测参数**:
  - `conf_threshold`: 置信度阈值 (默认: 0.5)

## 示例输出

运行程序时，控制台会显示：
- 处理帧数
- 检测到的人数
- 检测到的车辆数量
- 实时FPS
- 处理时间统计

## 自定义配置

可以修改以下参数来适应不同需求：

1. **目标类别**: 修改 `target_classes` 列表
2. **颜色方案**: 修改 `colors` 字典
3. **轨迹长度**: 修改 `deque(maxlen=30)` 参数
4. **模型**: 更改 `model_path` 参数使用不同的YOLO模型

## 故障排除

1. **摄像头无法打开**: 检查摄像头是否被其他程序占用
2. **模型下载失败**: 确保网络连接正常，程序会自动下载YOLOv8模型
3. **性能问题**: 尝试降低视频分辨率或使用更轻量的YOLO模型

## 扩展功能

可以考虑添加：
- 更高级的跟踪算法（如DeepSORT）
- 多摄像头支持
- 异常行为检测
- 车牌识别
- 数据统计和分析功能